#!/bin/sh

echo '(* AUTOMATICALLY GENERATED BY src/sdml/silly *)' > Stardust.grm
echo '(* DO NOT EDIT THIS FILE -- edit Stardust.silly.grm instead *)' >> Stardust.grm

cat Stardust.silly.grm \
| perl -ne 's/\blocify\b/(#3(argument))/g
   ; s/\btoLocation\b/(#2(argument))/g
   ; s/\berr\b/(#1(argument))/g
   ; s/#LOCIFY  *\(\b[a-zA-Z_0-9][a-zA-Z_0-9]*\b\)/(#3(argument)) \1left \1right/g
   ; print' \
| sed \
    -e '/#if 0/,/#endif/ d' \
    -e '/#if 1/ d' \
    -e '/#endif/ d' \
 >> Stardust.grm

# sed -e 's/\<locify\>/(#3(argument))/g' \
#        -e 's/\<toLocation\>/(#2(argument))/g' \
#        -e 's/\<err\>/(#1(argument))/g' \
#        -e 's/#LOCIFY  *\(\<[a-zA-Z_0-9][a-zA-Z_0-9]*\>\)/(#3(argument)) \1left \1right/g' \
#        -e '/#if 0/,/#endif/ d' \
#        -e '/#if 1/ d' \
#        -e '/#endif/ d' \
#        Stardust.silly.grm >> Stardust.grm

# sed -e 's/\<locify\>/(#3(argument))/g' \
#       -e 's/\<toLocation\>/(#2(argument))/g' \
#       -e 's/\<err\>/(#1(argument))/g' \
#       -e '/#if 0/,/#endif/ d' \
#       sdml.silly.grm > sdml.grm
#
##sed -e 's/Util\/sources.cm/Util\/smlnj-lib.cm/' \
##    sources.silly.cm > sources.cm
